<ui-modal [modalHidden]="!videoSave.videoSave">
  <div class="save-container">
    <div class="save-side">
      <ui-group-box [groupBoxLabel]="'VIDEO_SAVE.STATUS' | translate">
        <b [class]="videoReencode ? 'text-red-500' : videoSave.videoCut ? videoOutput.videoCut == 'smart' ? 'text-yellow-400' : videoOutput.videoCut == 'lossy' ? 'text-red-500' : 'text-green-500' : 'text-green-500'">
          {{ videoReencode ? ('VIDEO_SAVE.LOSSY' | translate) : videoSave.videoCut ? videoOutput.videoCut == 'smart' ? ('VIDEO_SAVE.LOSSLESS' | translate)
          : videoOutput.videoCut == 'lossy' ? ('VIDEO_SAVE.LOSSY' | translate) : ('VIDEO_SAVE.LOSSLESS' | translate) : ('VIDEO_SAVE.LOSSLESS' | translate) }}</b>
      </ui-group-box>
      <div>
        <span>
          <ui-button buttonColor="dark" buttonIcon="clear" [buttonToggle]="filters.filterInfo.filterClear"
            [buttonTooltip]="'VIDEO_PLAYER.CLEAR' | translate" (click)="videoFilterClear()"></ui-button>
          <ui-button buttonColor="dark" buttonIcon="noaudio" [buttonToggle]="filters.filterInfo.filterNoAudio"
            [buttonTooltip]="'VIDEO_PLAYER.NO_AUDIO' | translate" (click)="videoFilterNoAudio()"></ui-button>
        </span>
        <div class="save-separator"></div>
        <ui-button buttonColor="danger" buttonIcon="rotate" (click)="videoSaveReset()">{{ 'VIDEO_SAVE.RESET' | translate }}</ui-button>
        <ui-button buttonColor="primary" buttonIcon="edit" (click)="videoSaveEdit()">{{ 'VIDEO_SAVE.EDIT' | translate }}</ui-button>
        <div class="save-separator"></div>
        <ui-button buttonColor="secondary" buttonIcon="close" (click)="$videoSave(true)">{{ 'GENERAL.CANCEL' | translate }}</ui-button>
        <ui-button buttonColor="success" buttonIcon="done" (click)="videoSaveExport()">{{ 'VIDEO_SAVE.EXPORT' | translate }}</ui-button>
      </div>
    </div>
    <div *ngIf="store.state.playerInfo.playerVideo[0]" class="save-options">
      <ui-group-box [groupBoxLabel]="'VIDEO_SAVE.FORMAT.FORMATCODEC' | translate">
        <div class="save-section">
          <ui-select [selectLabel]="'VIDEO_SAVE.FORMAT.FORMAT' | translate" [(selectValue)]="videoOutput.videoFormat"
            (selectUpdate)="videoOutputFormat($event)">
            <ui-option-group *ngIf="videoFormat as f" [optionLabel]="'VIDEO_SAVE.FORMAT.DETECTED' | translate">
              <ui-option [optionLabel]="f.extensions[0] + ' | ' + f.name" [optionSelected]="true" [optionValue]="f"></ui-option>
            </ui-option-group>
            <ui-option-group *ngIf="videoFormats.length > 0" [optionLabel]="'VIDEO_SAVE.FORMAT.CONTAINERS' | translate">
              <div *ngFor="let f of videoFormats">
                <ui-option [optionLabel]="f.extensions[0] + ' | ' + f.name" [optionValue]="f"></ui-option>
              </div>
            </ui-option-group>
          </ui-select>
          <ui-select *ngIf="videoOutput.videoFormat" [selectLabel]="'GENERAL.CODEC' | translate"
            [(selectValue)]="videoOutput.videoCodec" (selectUpdate)="videoOutputCodec()">
            <ui-option-group *ngIf="videoCodec as c" [optionLabel]="'VIDEO_SAVE.FORMAT.DETECTED' | translate">
              <ui-option [optionLabel]="c.code + ' | ' + c.name" [optionSelected]="true" [optionValue]="c"></ui-option>
            </ui-option-group>
            <ui-option-group *ngIf="videoCodecs.length > 0" [optionLabel]="'VIDEO_SAVE.FORMAT.CODECS' | translate">
              <div *ngFor="let c of videoCodecs">
                <ui-option [optionLabel]="c.code + ' | ' + c.name" [optionValue]="c"></ui-option>
              </div>
            </ui-option-group>
          </ui-select>
          <ui-select *ngIf="videoOutput.videoCodec as c" [selectLabel]="'VIDEO_SAVE.FORMAT.ENCODER' | translate"
            [(selectValue)]="videoOutput.videoEncoder" (selectUpdate)="videoOutputEncoder($event)">
            <ui-option-group [optionLabel]="'VIDEO_SAVE.FORMAT.DEFAULT' | translate">
              <ui-option *ngIf="(videoSave.$videoFilters.length == 0 && store.state.filterInfo.filterConcat.length == 0)
                && videoOutput.videoCodec.code == store.state.videoInfo[0].videoStreams[1].codec_name"
                [optionLabel]="'VIDEO_SAVE.FORMAT.NONE' | translate" [optionSelected]="true" [optionValue]="null"></ui-option>
              <ui-option *ngIf="(videoSave.$videoFilters.length > 0 || store.state.filterInfo.filterConcat.length > 0)
                || videoOutput.videoCodec.code != store.state.videoInfo[0].videoStreams[1].codec_name"
                [optionLabel]="c.encoders[0]" [optionSelected]="!videoOutput.videoEncoder" [optionValue]="c.encoders[0]"></ui-option>
            </ui-option-group>
            <ui-option-group *ngIf="((videoSave.$videoFilters.length > 0 || store.state.filterInfo.filterConcat.length > 0)
                || videoOutput.videoCodec.code != store.state.videoInfo[0].videoStreams[1].codec_name)
                && c.encoders.length == 1 ? false : true" [optionLabel]="'VIDEO_SAVE.FORMAT.ENCODERS' | translate">
              <div *ngFor="let e of c.encoders; index as i">
                <ui-option *ngIf="((videoSave.$videoFilters.length == 0 && store.state.filterInfo.filterConcat.length == 0)
                  && videoOutput.videoCodec.code == store.state.videoInfo[0].videoStreams[1].codec_name)
                  || (c.encoders.length > 0 && i != 0)" [optionLabel]="e" [optionValue]="e"></ui-option>
              </div>
            </ui-option-group>
          </ui-select>
        </div>
      </ui-group-box>
      <ui-group-box [groupBoxLabel]="'VIDEO_SAVE.ENCODING.ENCODING' | translate">
        <div class="save-section">
          <ui-select [selectDisabled]="!videoReencode || !videoOutput.videoRate"
            [selectLabel]="'VIDEO_SAVE.ENCODING.RATE' | translate" [(selectValue)]="videoOutput.videoRate">
            <div *ngIf="videoRates.length > 0">
              <ui-option-group [optionLabel]="'VIDEO_SAVE.FORMAT.DEFAULT' | translate">
                <ui-option [optionLabel]="videoRates[0].text" [optionSelected]="true" [optionValue]="videoRates[0].value"></ui-option>
              </ui-option-group>
              <ui-option-group [optionLabel]="'VIDEO_SAVE.ENCODING.RATES' | translate">
                <div *ngFor="let e of videoRates; index as i">
                  <ui-option *ngIf="i != 0 && (videoSave.videoCut ? (e.value == 'vbv2' || e.value == 'abr2') ? false : true : true)"
                    [optionLabel]="e.text" [optionValue]="e.value"></ui-option>
                </div>
              </ui-option-group>
            </div>
          </ui-select>
          <div>
            <ui-input [inputDisabled]="!videoReencode || !videoOutput.videoRate || !videoEncoder.rates[videoOutput.videoRate].includes('$crf')"
              [inputLabel]="'VIDEO_SAVE.ENCODING.QUALITY' | translate: { max: (videoEncoder?.quality[1] || 0) }"
              [inputMax]="videoEncoder?.quality[1] || 0" inputType="number" [(inputValue)]="videoOutput.videoQuality"></ui-input>
            <ui-input [inputDisabled]="!videoReencode || !videoOutput.videoRate || !videoEncoder.rates[videoOutput.videoRate].includes('$bit')"
              [inputLabel]="'VIDEO_SAVE.ENCODING.BITRATE' | translate" [inputPlaceholder]="'GENERAL.DEFAULT' | translate"
              inputType="number" [(inputValue)]="videoOutput.videoBitrate"></ui-input>
          </div>
          <ui-select [selectDisabled]="!videoReencode || !videoOutput.videoPreset"
            [selectLabel]="'VIDEO_SAVE.ENCODING.PRESET' | translate" [(selectValue)]="videoOutput.videoPreset">
            <div *ngIf="videoPresets.length > 0">
              <ui-option-group [optionLabel]="'GENERAL.DEFAULT' | translate">
                <ui-option [optionLabel]="videoPresets[0].text" [optionSelected]="true" [optionValue]="videoPresets[0].value"></ui-option>
              </ui-option-group>
              <ui-option-group [optionLabel]="'VIDEO_SAVE.ENCODING.PRESETS' | translate">
                <div *ngFor="let e of videoPresets; index as i">
                  <ui-option *ngIf="i != 0" [optionLabel]="e.text" [optionValue]="e.value"></ui-option>
                </div>
              </ui-option-group>
            </div>
          </ui-select>
        </div>
      </ui-group-box>
      <ui-group-box [groupBoxLabel]="'VIDEO_SAVE.SCALING.SCALING' | translate">
        <div class="save-section">
          <div>
            <ui-input [inputLabel]="'VIDEO_SAVE.SCALING.WIDTH' | translate" inputType="number"
              [(inputValue)]="filters.filterInfo.filterWidth" (inputUpdated)="videoScalerWidth($event)"></ui-input>
            <ui-input [inputLabel]="'VIDEO_SAVE.SCALING.HEIGHT' | translate" inputType="number"
              [(inputValue)]="filters.filterInfo.filterHeight" (inputUpdated)="videoScalerHeight($event)"></ui-input>
            <ui-button buttonColor="dark" [buttonIcon]="videoOutput.videoLock ? 'lock' : 'unlock'"
              [buttonToggle]="!videoOutput.videoLock" (click)="videoScalerLock()"></ui-button>
          </div>
          <div>
            <div class="w-[132px]">
              <ui-select [selectLabel]="'VIDEO_SAVE.SCALING.SCALE' | translate"
                [(selectValue)]="videoOutput.videoScale" (selectClick)="videoScalerScale($event)">
                <div *ngFor="let s of videoScaler.scale; index as i">
                  <ui-option *ngIf="i == 0 && videoOutput.videoScale == 0" [optionLabel]="s.text" [optionValue]="s.value"></ui-option>
                  <ui-option *ngIf="i > 0" [optionLabel]="s.text" [optionSelected]="i == 1" [optionValue]="s.value"></ui-option>
                </div>
              </ui-select>
            </div>
            <div class="w-[180px]">
              <ui-select [selectLabel]="'VIDEO_SAVE.SCALING.ASPECT_RATIO' | translate"
                [(selectValue)]="videoOutput.videoRatio" (selectClick)="videoScalerRatio($event)">
                <div *ngFor="let a of videoScaler.ratio; index as i">
                  <ui-option *ngIf="i == 0 && videoOutput.videoRatio == 0" [optionLabel]="a.text" [optionValue]="a.value"></ui-option>
                  <ui-option *ngIf="i > 0" [optionLabel]="a.text" [optionSelected]="i == 1" [optionValue]="a.value"></ui-option>
                </div>
              </ui-select>
            </div>
          </div>
          <ui-select [selectLabel]="'VIDEO_SAVE.SCALING.ALGORITHM' | translate" [(selectValue)]="filters.filterInfo.filterAlgorithm">
            <ui-option-group [optionLabel]="'GENERAL.DEFAULT' | translate">
              <ui-option [optionLabel]="videoScaler.algorithm[0].text" [optionSelected]="true" [optionValue]="videoScaler.algorithm[0].value"></ui-option>
            </ui-option-group>
            <ui-option-group [optionLabel]="'VIDEO_SAVE.ENCODING.PRESETS' | translate">
              <div *ngFor="let s of videoScaler.algorithm; index as i">
                <ui-option *ngIf="i != 0" [optionLabel]="s.text" [optionValue]="s.value"></ui-option>
              </div>
            </ui-option-group>
          </ui-select>
        </div>
      </ui-group-box>
      <ui-group-box [groupBoxLabel]="'VIDEO_SAVE.OUTPUT' | translate">
        <div class="save-section">
          <ui-select [selectDisabled]="!videoSave.videoCut" [selectLabel]="'VIDEO_SAVE.CLIP_CONCAT' | translate" [(selectValue)]="videoOutput.videoConcat">
            <div *ngFor="let c of videoConcat; index as i">
              <ui-option *ngIf="i == 0" [optionLabel]="c.name" [optionSelected]="true" [optionValue]="c.code"></ui-option>
              <ui-option *ngIf="i > 0" [optionLabel]="c.name" [optionValue]="c.code"></ui-option>
            </div>
          </ui-select>
          <ui-select [selectDisabled]="!videoSave.videoCut" [selectLabel]="'VIDEO_SAVE.CLIP_CUT' | translate" [(selectValue)]="videoOutput.videoCut">
            <ui-option-group [optionLabel]="'VIDEO_SAVE.FORMAT.DEFAULT' | translate">
              <ui-option [optionLabel]="videoCut[0].name" [optionSelected]="true" [optionValue]="videoCut[0].code"></ui-option>
            </ui-option-group>
            <ui-option-group [optionLabel]="'VIDEO_SAVE.ENCODING.RATES' | translate">
              <div *ngFor="let c of videoCut; index as i">
                <ui-option *ngIf="i != 0" [optionLabel]="c.name" [optionValue]="c.code"></ui-option>
              </div>
            </ui-option-group>
          </ui-select>
          <div class="save-output">
            <ui-input [inputLabel]="'VIDEO_SAVE.PATH' | translate" [(inputValue)]="videoSave.videoOutput"></ui-input>
            <ui-button buttonColor="dark" buttonIcon="more" (click)="videoSaveDirectory()"></ui-button>
          </div>
        </div>
      </ui-group-box>
    </div>
  </div>
</ui-modal>
<ui-modal *ngIf="videoSave.videoEditing">
  <textarea [(ngModel)]="videoSave.videoCommand" spellcheck="false"></textarea>
  <div class="save-buttons">
    <ui-button buttonColor="success" buttonIcon="done" (click)="videoSaveRun()">{{ 'VIDEO_SAVE.EXPORT' | translate }}</ui-button>
    <ui-button buttonColor="secondary" buttonIcon="close" (click)="videoSaveEdit()">{{ 'GENERAL.CANCEL' | translate }}</ui-button>
  </div>
</ui-modal>
<ui-modal *ngIf="videoSave.videoSaving || videoSave.videoSaved">
  <div class="save-saving">
    <div *ngIf="videoSave.videoSaving">
      <p>{{ 'VIDEO_SAVE.SAVE.SAVING' | translate }}</p>
    </div>
    <div *ngIf="!videoSave.videoSaving">
      <div *ngIf="!videoSave.videoErrorText">
        <p>{{ 'VIDEO_SAVE.SAVE.SAVE_OK' | translate }}</p>
      </div>
      <div *ngIf="videoSave.videoErrorText">
        <p>{{ 'VIDEO_SAVE.SAVE.SAVE_ERROR' | translate }}</p>
      </div>
      <div class="save-buttons">
        <ui-button *ngIf="videoSave.videoErrorText" buttonColor="danger" buttonIcon="list" (click)="videoSaveError()">{{ 'VIDEO_SAVE.ERROR_LOG' | translate }}</ui-button>
        <ui-button [buttonColor]="videoSave.videoErrorText ? 'secondary' : 'success'" [buttonIcon]="videoSave.videoErrorText ? 'close' : 'done'"
          (click)="videoSaveClose()">{{ (videoSave.videoErrorText ? 'GENERAL.CLOSE' : 'GENERAL.OK') | translate }}</ui-button>
      </div>
      <div *ngIf="videoSave.videoErrorView" class="save-error">
        <span [innerText]="videoSave.videoErrorText"></span>
      </div>
    </div>
  </div>
</ui-modal>